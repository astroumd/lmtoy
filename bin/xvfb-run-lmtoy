#! /bin/bash
#

nxmax=20
sleep=1

nx=$(ps aux | grep '/Xvfb/' | grep -v grep | wc -l)

while [ $nx -ge $nxmax ]; do
    echo "xvfb-run-lmtoy:   too many xvfb's running [$nx], waiting $sleep seconds"    
    sleep $sleep
    nx=$(ps aux | grep '/Xvfb/' | grep -v grep | wc -l)    
done

echo "xvfb-run [$nx]"
exec xvfb-run $*
